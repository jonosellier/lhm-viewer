import{s as R,e as v,a as y,t as A,c as x,l as E,g as w,b as T,d as B,f as c,m,i as f,h as V,q as J,j as Z,n as D,k as M,D as O}from"../chunks/scheduler.DNAvik3t.js";import{S as q,i as z,c as $,a as G,m as K,t as Q,b as W,d as X}from"../chunks/index.CWoPOsBs.js";import{g as Y}from"../chunks/entry.wu6mbweq.js";import{u as tt,p as H,f as et,M as st}from"../chunks/db.DFsKxybz.js";import{b as nt}from"../chunks/paths.BFj7nehY.js";import{n as I}from"../chunks/notification.service.bvJViLgf.js";function lt(p){const n=p.replace(/\r/g,"").split(/^-+$/gm).find(r=>r.match(/\nSensors\n\n/)),a={};if(n){const r=n.replace(/\r?\nSensors(\r?\n)+((.+\n)+)/,"$2"),l=JSON.parse(`{${r.replace(/((\||(\+-))\s*)+([A-Za-z\s0-9-#/+_()*]+)(\s+:(\s+-?\d+(.\d+(E\+?-?\d\d)?)?)*)?\s\((.+)\)/gm,'"$9": "$4"').split(`
`).filter(o=>!!o).map(o=>o.replace(/\s+"$/,'"')).join(",")}}`);a.sensors=l}return console.log(a),a}function at(p){let s,n="Upload a Logging CSV file and optionally a Hardware Report from Libre Hardware Monitor to begin",a,r,l="Uploading a hardware report will better group the sensor data with more user-friendly names",o,u,S="Log File",C,_,U,e,k="Hardware Report",b,d,g,h,j=p[2]?"Uploading":"Load in to Chart",P,N,L,F;return{c(){s=v("p"),s.textContent=n,a=y(),r=v("p"),r.textContent=l,o=y(),u=v("p"),u.textContent=S,C=y(),_=v("input"),U=y(),e=v("p"),e.textContent=k,b=y(),d=v("input"),g=y(),h=v("button"),P=A(j),this.h()},l(t){s=x(t,"P",{class:!0,"data-svelte-h":!0}),E(s)!=="svelte-jbdxtz"&&(s.textContent=n),a=w(t),r=x(t,"P",{"data-svelte-h":!0}),E(r)!=="svelte-1hfj7ju"&&(r.textContent=l),o=w(t),u=x(t,"P",{class:!0,"data-svelte-h":!0}),E(u)!=="svelte-10mpmck"&&(u.textContent=S),C=w(t),_=x(t,"INPUT",{type:!0,accept:!0,class:!0}),U=w(t),e=x(t,"P",{class:!0,"data-svelte-h":!0}),E(e)!=="svelte-17oba2g"&&(e.textContent=k),b=w(t),d=x(t,"INPUT",{type:!0,accept:!0,class:!0}),g=w(t),h=x(t,"BUTTON",{class:!0});var i=T(h);P=B(i,j),i.forEach(c),this.h()},h(){m(s,"class","text-center text-2xl"),m(u,"class","text-slate-500 mt-6 ps-2"),m(_,"type","file"),m(_,"accept",".csv"),m(_,"class","form-control mb-6"),m(e,"class","text-slate-500 ps-2"),m(d,"type","file"),m(d,"accept",".txt"),m(d,"class","form-control"),m(h,"class","btn-primary btn-lg mt-5 w-full"),h.disabled=N=p[2]||!p[0]?.files},m(t,i){f(t,s,i),f(t,a,i),f(t,r,i),f(t,o,i),f(t,u,i),f(t,C,i),f(t,_,i),p[4](_),f(t,U,i),f(t,e,i),f(t,b,i),f(t,d,i),p[5](d),f(t,g,i),f(t,h,i),V(h,P),L||(F=J(h,"click",p[6]),L=!0)},p(t,[i]){i&4&&j!==(j=t[2]?"Uploading":"Load in to Chart")&&Z(P,j),i&5&&N!==(N=t[2]||!t[0]?.files)&&(h.disabled=N)},i:D,o:D,d(t){t&&(c(s),c(a),c(r),c(o),c(u),c(C),c(_),c(U),c(e),c(b),c(d),c(g),c(h)),p[4](null),p[5](null),L=!1,F()}}}function rt(p,s,n){let a,r;M(p,tt,e=>n(7,a=e)),M(p,H,e=>n(8,r=e));let l,o,u=!1;async function S(){try{if(!l.files?.[0]){I.error("Please upload a log file");return}n(2,u=!0);const e=l.files[0],k=await e.text();let b="";if(o.files?.length?b=await o.files[0].text():Object.keys(r.sensorName).length<1&&I.info("Sensor names might look a little weird unless you have uploaded a report at least once"),n(2,u=!1),b){console.log({c:b});const d=lt(b);H.update(g=>(g.sensorName={...g.sensorName,...d.sensors},console.log({p:g}),g))}et.set(new st(k,e.name,a?.id)),I.info("Upload success"),Y(nt+"/new")}catch(e){n(2,u=!1),I.error(e)}}function C(e){O[e?"unshift":"push"](()=>{l=e,n(0,l)})}function _(e){O[e?"unshift":"push"](()=>{o=e,n(1,o)})}return[l,o,u,S,C,_,()=>S()]}class ot extends q{constructor(s){super(),z(this,s,rt,at,R,{})}}function it(p){let s,n,a,r;return a=new ot({}),{c(){s=v("div"),n=v("div"),$(a.$$.fragment),this.h()},l(l){s=x(l,"DIV",{class:!0});var o=T(s);n=x(o,"DIV",{class:!0});var u=T(n);G(a.$$.fragment,u),u.forEach(c),o.forEach(c),this.h()},h(){m(n,"class","p-8 rounded-xl border border-slate-500 bg-slate-800"),m(s,"class","flex items-center justify-center h-full")},m(l,o){f(l,s,o),V(s,n),K(a,n,null),r=!0},p:D,i(l){r||(Q(a.$$.fragment,l),r=!0)},o(l){W(a.$$.fragment,l),r=!1},d(l){l&&c(s),X(a)}}}class _t extends q{constructor(s){super(),z(this,s,null,it,R,{})}}export{_t as component};
